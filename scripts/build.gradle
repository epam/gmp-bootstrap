configure(subprojects) { subproject ->
    if (!subproject.name.startsWith('ext-')) {

        sourceSets {
            main {
                groovy { exclude '*.groovy' }
                java {}
            }
        }

        dependencies {
            implementation project(':customizations')
        }

        task copyScripts(type: Copy) {
            into "${rootProject.buildDir}/$outPath/$subproject.name"
            from('src/main/groovy') {
                include '*.groovy'
                include '*.yaml'
                include '*.properties'
            }
        }

        task copyToLib(type: Copy) {
            into "${rootProject.buildDir}/$outPath/$subproject.name/lib"
            from configurations.export
        }

        tasks.withType(Jar) {
            destinationDirectory = file("${rootProject.buildDir}/$outPath/$subproject.name/lib")
        }

        jar.dependsOn copyScripts, copyToLib
    }
}